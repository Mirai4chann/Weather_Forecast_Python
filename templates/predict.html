<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Predict - Weather Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes float1 { 0%,100% { transform: translate(0,0) rotate(0deg); } 25% { transform: translate(10px,-20px) rotate(5deg); } 50% { transform: translate(-5px,-40px) rotate(-3deg); } 75% { transform: translate(-15px,-20px) rotate(3deg); } }
        @keyframes float2 { 0%,100% { transform: translate(0,0) rotate(0deg); } 25% { transform: translate(-15px,-30px) rotate(-5deg); } 50% { transform: translate(10px,-50px) rotate(5deg); } 75% { transform: translate(20px,-25px) rotate(-3deg); } }
        @keyframes float3 { 0%,100% { transform: translate(0,0); } 33% { transform: translate(20px,-35px); } 66% { transform: translate(-10px,-60px); } }
        @keyframes float4 { 0%,100% { transform: translate(0,0) scale(1); } 50% { transform: translate(-20px,-45px) scale(1.1); } }
        @keyframes float5 { 0%,100% { transform: translate(0,0); } 25% { transform: translate(15px,-25px); } 75% { transform: translate(-25px,-35px); } }
        @keyframes pulse-glow { 0%,100% { opacity: 0.6; filter: blur(40px); } 50% { opacity: 1; filter: blur(60px); } }
        @keyframes rain { 0% { transform: translateY(-100%); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(100vh); opacity: 0; } }
        @keyframes twinkle { 0%,100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        @keyframes sun-rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0%,100% { box-shadow: 0 0 40px rgba(255,200,100,0.4), 0 0 80px rgba(100,180,255,0.3); } 50% { box-shadow: 0 0 60px rgba(255,200,100,0.6), 0 0 120px rgba(100,180,255,0.5); } }
        @keyframes bounce-slow { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-float1 { animation: float1 8s ease-in-out infinite; }
        .animate-float2 { animation: float2 10s ease-in-out infinite; }
        .animate-float3 { animation: float3 12s ease-in-out infinite; }
        .animate-float4 { animation: float4 9s ease-in-out infinite; }
        .animate-float5 { animation: float5 11s ease-in-out infinite; }
        .animate-sun-rotate { animation: sun-rotate 60s linear infinite; }
        .animate-twinkle { animation: twinkle 2s ease-in-out infinite; }
        .animate-fade-in { animation: fade-in 0.8s ease-out; }
        .animate-glow { animation: glow 3s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 4s ease-in-out infinite; }
        .animate-bounce-slow { animation: bounce-slow 2s ease-in-out infinite; }
        .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); }
        html, body, #root { height: 100%; margin: 0; overflow: auto; }
        .weather-bg { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 100%); }
        .sun-glow { filter: drop-shadow(0 0 30px rgba(255,200,50,0.8)) drop-shadow(0 0 60px rgba(255,150,0,0.5)); }
        .cloud-shadow { filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3)); }
        * { scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2); }
        *::-webkit-scrollbar { width: 8px; }
        *::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        *::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
{% raw %}
    <script type="text/babel">
        const { useState, useEffect } = React;

        const FloatingIcons = () => (
            <div className="fixed inset-0 overflow-hidden pointer-events-none z-0">
                <div className="absolute top-10 right-20 animate-float1">
                    <div className="relative">
                        <div className="absolute inset-0 w-24 h-24 bg-yellow-400 rounded-full animate-pulse-glow"></div>
                        <svg className="w-24 h-24 text-yellow-400 sun-glow animate-sun-rotate" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="20" fill="currentColor"/>
                            {[...Array(12)].map((_, i) => (<line key={i} x1="50" y1="10" x2="50" y2="20" stroke="currentColor" strokeWidth="3" strokeLinecap="round" transform={`rotate(${i * 30} 50 50)`}/>))}
                        </svg>
                    </div>
                </div>
                <svg className="absolute top-32 left-10 w-32 h-20 text-white/30 animate-float2 cloud-shadow" viewBox="0 0 100 60"><ellipse cx="30" cy="40" rx="25" ry="15" fill="currentColor"/><ellipse cx="55" cy="35" rx="20" ry="18" fill="currentColor"/><ellipse cx="75" cy="42" rx="18" ry="12" fill="currentColor"/><ellipse cx="45" cy="45" rx="30" ry="12" fill="currentColor"/></svg>
                <svg className="absolute top-20 left-1/3 w-24 h-16 text-white/20 animate-float3 cloud-shadow" viewBox="0 0 100 60"><ellipse cx="30" cy="40" rx="25" ry="15" fill="currentColor"/><ellipse cx="55" cy="35" rx="20" ry="18" fill="currentColor"/><ellipse cx="75" cy="42" rx="18" ry="12" fill="currentColor"/><ellipse cx="45" cy="45" rx="30" ry="12" fill="currentColor"/></svg>
                <svg className="absolute bottom-40 right-10 w-36 h-22 text-white/25 animate-float4 cloud-shadow" viewBox="0 0 100 60"><ellipse cx="30" cy="40" rx="25" ry="15" fill="currentColor"/><ellipse cx="55" cy="35" rx="20" ry="18" fill="currentColor"/><ellipse cx="75" cy="42" rx="18" ry="12" fill="currentColor"/><ellipse cx="45" cy="45" rx="30" ry="12" fill="currentColor"/></svg>
                <svg className="absolute bottom-20 left-20 w-28 h-18 text-white/15 animate-float5 cloud-shadow" viewBox="0 0 100 60"><ellipse cx="30" cy="40" rx="25" ry="15" fill="currentColor"/><ellipse cx="55" cy="35" rx="20" ry="18" fill="currentColor"/><ellipse cx="75" cy="42" rx="18" ry="12" fill="currentColor"/><ellipse cx="45" cy="45" rx="30" ry="12" fill="currentColor"/></svg>
                <div className="absolute bottom-32 right-1/4 animate-float3"><svg className="w-16 h-16 text-gray-200/40" viewBox="0 0 100 100" style={{ filter: 'drop-shadow(0 0 20px rgba(200,200,255,0.5))' }}><path d="M50 10 A40 40 0 1 0 50 90 A30 30 0 1 1 50 10" fill="currentColor"/></svg></div>
                <div className="absolute top-0 left-1/4 w-1 h-8 bg-gradient-to-b from-transparent via-blue-400/50 to-transparent rounded-full" style={{ animation: 'rain 2s linear infinite' }}></div>
                <div className="absolute top-0 left-1/3 w-1 h-6 bg-gradient-to-b from-transparent via-blue-400/40 to-transparent rounded-full" style={{ animation: 'rain 2.5s linear infinite', animationDelay: '0.5s' }}></div>
                <div className="absolute top-0 left-2/3 w-1 h-10 bg-gradient-to-b from-transparent via-blue-400/30 to-transparent rounded-full" style={{ animation: 'rain 1.8s linear infinite', animationDelay: '1s' }}></div>
                <div className="absolute top-1/4 right-1/3 text-2xl animate-float2" style={{ filter: 'drop-shadow(0 0 10px rgba(255,255,255,0.8))' }}>‚ùÑÔ∏è</div>
                <div className="absolute top-1/2 left-1/4 text-xl animate-float4" style={{ filter: 'drop-shadow(0 0 10px rgba(255,255,255,0.6))' }}>‚ùÑÔ∏è</div>
                {[...Array(8)].map((_, i) => (<div key={i} className="absolute w-1 h-1 bg-white rounded-full animate-twinkle" style={{ top: `${10 + i * 12}%`, left: `${5 + i * 13}%`, animationDelay: `${i * 0.3}s` }}></div>))}
                <svg className="absolute top-40 right-1/3 w-10 h-16 text-yellow-300/50 animate-float1" viewBox="0 0 24 48" style={{ filter: 'drop-shadow(0 0 10px rgba(255,255,0,0.8))' }}><path d="M13 2L4 22h7l-2 24 11-28h-8z" fill="currentColor"/></svg>
            </div>
        );

        const MapPinIcon = () => (<svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>);

        function StatCard({ icon, label, value, color }) {
            return (<div className="glass rounded-2xl p-4 relative overflow-hidden group hover:scale-105 transition-transform"><div className={`absolute inset-0 bg-gradient-to-br ${color} opacity-20 group-hover:opacity-30 transition-opacity`}></div><div className="relative z-10"><div className="flex items-center gap-3 mb-2"><div className="text-white/80 text-xl">{icon}</div><p className="text-white/70 text-sm">{label}</p></div><p className="text-xl font-bold text-white">{value}</p></div></div>);
        }

        function PredictApp() {
            const [prediction, setPrediction] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [city, setCity] = useState('');
            const [selectedIndex, setSelectedIndex] = useState(0);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const cityParam = params.get('city');
                if (cityParam) {
                    setCity(cityParam);
                    fetchPrediction(cityParam);
                }
            }, []);

            useEffect(() => { if (prediction && prediction.forecast) setSelectedIndex(0); }, [prediction]);

            async function fetchPrediction(cityName) {
                setLoading(true); setError(''); setPrediction(null);
                try {
                    const res = await fetch('/predict-weather', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ city: cityName, days: 7 }) });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error || 'Failed to fetch');
                    setPrediction(data);
                } catch (e) { setError('Network error. Please try again.'); } finally { setLoading(false); }
            }

            function emojiFor(cond) {
                if (!cond) return 'üå§Ô∏è';
                const c = cond.toLowerCase();
                if (c.includes('rain')) return 'üåßÔ∏è';
                if (c.includes('cloud')) return '‚òÅÔ∏è';
                if (c.includes('clear') || c.includes('sun')) return '‚òÄÔ∏è';
                if (c.includes('snow')) return '‚ùÑÔ∏è';
                if (c.includes('thunder')) return '‚õàÔ∏è';
                if (c.includes('fog')) return 'üå´Ô∏è';
                return 'üå§Ô∏è';
            }

            function buildSparklinePoints(forecast) {
                if (!forecast || !forecast.length) return '';
                const temps = forecast.map(d => Number(d.avg_temp) || 0);
                const min = Math.min(...temps); const max = Math.max(...temps);
                const range = Math.max(1, max - min);
                return temps.map((t, i) => {
                    const x = (temps.length === 1) ? 50 : (i / (temps.length - 1)) * 100;
                    const y = 30 - ((t - min) / range) * 30;
                    return `${x},${y}`;
                }).join(' ');
            }

            const highest = prediction?.forecast?.length ? Math.max(...prediction.forecast.map(f => Number(f.max_temp) || -999)) : null;
            const lowest = prediction?.forecast?.length ? Math.min(...prediction.forecast.map(f => Number(f.min_temp) || 999)) : null;

            function suggestionsFor(day) {
                const out = [];
                const t = Number(day.avg_temp) || 0;
                const max = Number(day.max_temp) || t;
                const cond = (day.condition || '').toLowerCase();
                if (/rain|shower|drizzle|thunder/.test(cond)) out.push('‚òî Bring an umbrella and wear waterproof shoes.');
                else if (/snow|sleet/.test(cond)) out.push('‚ùÑÔ∏è Snow expected: wear warm waterproof boots.');
                else if (/clear|sunny/.test(cond) && max >= 28) out.push('‚òÄÔ∏è Sunny & hot: apply sunscreen and stay hydrated.');
                else if (/cloud|overcast/.test(cond)) out.push('‚òÅÔ∏è Overcast: comfortable for outdoor activities.');
                else if (/fog|mist/.test(cond)) out.push('üå´Ô∏è Low visibility: drive carefully.');
                if (t >= 30) out.push('üíß High temps: avoid strenuous activity midday.');
                else if (t >= 20) out.push('üå§Ô∏è Warm: ideal for outdoor plans.');
                else if (t >= 10) out.push('üß• Cool: wear a mid-layer and light jacket.');
                else out.push('üßä Cold: dress in layers with coat, hat and gloves.');
                if (!/rain|snow|drizzle|sleet/.test(cond) && max >= 18) out.push('üß∫ Good day to dry laundry outside.');
                else if (/rain|snow|drizzle|sleet/.test(cond)) out.push('üö´ Not ideal for outdoor drying.');
                return out.slice(0, 4);
            }

            return (
                <div className="min-h-screen weather-bg relative">
                    <FloatingIcons />
                    
                    {/* Navigation */}
                    <header className="fixed top-6 left-1/2 -translate-x-1/2 z-50">
                        <nav className="glass rounded-full px-8 py-4 shadow-lg">
                            <ul className="flex gap-6 items-center">
                                <li><a href="/" className="text-base text-white/80 hover:text-white transition-colors">üè† Home</a></li>
                                <li className="w-px h-5 bg-white/30"></li>
                                <li><span className="text-base text-white">üìä Forecast</span></li>
                            </ul>
                        </nav>
                    </header>

                    {/* Main Content */}
                    <div className="min-h-screen flex items-center justify-center p-6 pt-24 relative z-10">
                        <div className="w-full max-w-6xl">
                            <div className="glass rounded-3xl p-8 shadow-2xl animate-fade-in animate-glow">
                                
                                {/* Header */}
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                                    <div>
                                        <h1 className="text-4xl md:text-5xl font-bold text-white mb-2" style={{ textShadow: '0 4px 30px rgba(255,255,255,0.3)' }}>üîÆ Weather Forecast</h1>
                                        {prediction && <div className="flex items-center gap-2 text-white/70 text-xl"><MapPinIcon /> {prediction.city}, {prediction.country}</div>}
                                    </div>
                                    {prediction?.forecast?.length > 0 && (
                                        <div className="text-center md:text-right">
                                            <div className="text-6xl font-extrabold text-white" style={{ textShadow: '0 4px 30px rgba(255,255,255,0.3)' }}>{prediction.forecast[selectedIndex].avg_temp}¬∞C</div>
                                            <div className="text-xl text-white/70">{emojiFor(prediction.forecast[selectedIndex].condition)} {prediction.forecast[selectedIndex].condition}</div>
                                        </div>
                                    )}
                                </div>

                                {/* Sparkline & Stats Row */}
                                <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="lg:col-span-3 glass rounded-2xl p-6">
                                        <p className="text-white/60 text-lg mb-4">Temperature Trend</p>
                                        <svg viewBox="0 0 100 30" className="w-full h-24" preserveAspectRatio="none">
                                            <defs>
                                                <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
                                                    <stop offset="0%" stopColor="#60a5fa" stopOpacity="0.4" />
                                                    <stop offset="100%" stopColor="#7c3aed" stopOpacity="0.1" />
                                                </linearGradient>
                                            </defs>
                                            {prediction?.forecast && (() => {
                                                const pts = buildSparklinePoints(prediction.forecast);
                                                if (!pts) return null;
                                                return (<g><polyline points={pts} fill="none" stroke="#60a5fa" strokeWidth="1.2" strokeLinejoin="round" strokeLinecap="round" /><polygon points={`${pts} 100,30 0,30`} fill="url(#g1)" /></g>);
                                            })()}
                                        </svg>
                                        <div className="flex justify-between text-sm text-white/50 mt-3">
                                            {prediction?.forecast?.map((d, i) => (<div key={i} className="text-center flex-1 truncate">{d.date.split(',')[0]}</div>))}
                                        </div>
                                    </div>
                                    <div className="flex flex-col gap-4">
                                        <StatCard icon="üî•" label="High" value={highest !== null ? `${highest}¬∞C` : '‚Äî'} color="from-orange-500 to-red-500" />
                                        <StatCard icon="‚ùÑÔ∏è" label="Low" value={lowest !== null ? `${lowest}¬∞C` : '‚Äî'} color="from-blue-500 to-cyan-500" />
                                    </div>
                                </div>

                                {/* Day Cards */}
                                <div className="mb-8">
                                    <p className="text-white/60 text-lg mb-4">7-Day Forecast</p>
                                    <div className="flex gap-4 overflow-x-auto pb-4">
                                        {prediction?.forecast?.map((d, idx) => (
                                            <button key={idx} onClick={() => setSelectedIndex(idx)} className={`flex-shrink-0 glass rounded-2xl p-5 min-w-[140px] text-center transition-all hover:scale-105 ${selectedIndex === idx ? 'ring-2 ring-cyan-400/50 bg-white/15' : 'hover:bg-white/10'}`}>
                                                <div className="text-white/70 text-sm mb-2">{d.date.split(',')[0]}</div>
                                                <div className="text-4xl mb-3">{emojiFor(d.condition)}</div>
                                                <div className="text-2xl font-bold text-white mb-2">{d.avg_temp}¬∞</div>
                                                <div className="flex justify-between text-sm text-white/60">
                                                    <span>‚¨ÜÔ∏è{d.max_temp}¬∞</span>
                                                    <span>‚¨áÔ∏è{d.min_temp}¬∞</span>
                                                </div>
                                            </button>
                                        )) || <div className="text-white/50">No forecast data</div>}
                                    </div>
                                </div>

                                {/* Suggestions Panel */}
                                <div className="glass rounded-2xl p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <p className="text-white/60 text-sm">Suggestions for</p>
                                            <p className="text-white text-xl font-semibold">{prediction?.forecast ? `${prediction.forecast[selectedIndex].date.split(',')[0]} ‚Ä¢ ${prediction.city}` : '‚Äî'}</p>
                                        </div>
                                        <div className="text-4xl">{prediction?.forecast ? emojiFor(prediction.forecast[selectedIndex].condition) : 'üí°'}</div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        {prediction?.forecast ? suggestionsFor(prediction.forecast[selectedIndex]).map((s, i) => (
                                            <div key={i} className="bg-white/5 rounded-xl p-4 text-white/80 text-base border border-white/10">{s}</div>
                                        )) : <div className="text-white/50">No suggestions</div>}
                                    </div>
                                </div>

                                {/* Footer */}
                                <p className="text-center text-white/40 text-sm mt-6">Powered by OpenWeatherMap API ‚Ä¢ Built with React & Tailwind CSS</p>
                            </div>
                        </div>
                    </div>

                    {/* Loading Overlay */}
                    {loading && (<div className="fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50"><div className="glass rounded-3xl p-16 text-center"><div className="text-7xl mb-8 animate-float1">üîÆ</div><p className="text-white text-2xl mb-3">Fetching forecast data...</p><p className="text-xl text-white/60">Please wait</p></div></div>)}

                    {/* Error Message */}
                    {error && !prediction && !loading && (<div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-50 max-w-lg w-full mx-6"><div className="bg-red-500/20 border-2 border-red-500/50 rounded-2xl p-6 backdrop-blur-xl"><p className="text-red-200 text-center text-xl">‚ö†Ô∏è {error}</p></div></div>)}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<PredictApp />);
    </script>
{% endraw %}
</body>
</html>